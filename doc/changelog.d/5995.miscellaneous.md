Improve code quality and handling of subprocess calls