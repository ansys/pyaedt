fix a bug in the reduce method