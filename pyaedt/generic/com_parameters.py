from pyaedt import pyaedt_function_handler
from pyaedt import settings

logger = settings.logger


class COMParameters:
    def __init__(self, standard="50GAUI-1_C2C"):
        self.version = "3.40"
        self.thrusnp = ""
        self.fextary = ""
        self.nextary = ""
        self.spectag = "Customized"
        self.fstthru = "-1"
        self.numport = "-1"
        self.genhtml = "T"
        self.a_dd = "0.05"
        self.a_fe = "0.4"
        self.a_ne = "0.6"
        self.a_ft = ""
        self.a_nt = ""
        self.a_v = "0.4"
        self.b_max1 = "1.0"
        self.b_min1 = ""
        self.b_max2_n_b = ""
        self.b_min2_n_b = ""
        self.c_1 = "[-0.18:0.02:0]"
        self.c_2 = ""
        self.c_3 = ""
        self.c_4 = ""
        self.c0 = "0.62"
        self.c1 = "[-0.38:0.02:0]"
        self.c2 = ""
        self.c3 = ""
        self.c_d = "[2.5e-4 2.5e-4]"
        self.c_p = "[1.8e-4 1.8e-4]"
        self.c_v = "0.0"
        self.l_s = ""
        self.c_b = ""
        self.local_search = ""
        self.delta_f = "0.01"
        self.ffe_backoff = "4"
        self.der_0 = "1.0E-5"
        self.eta_0 = "5.2E-8"
        self.f_b = "25.78125"
        self.f_1 = "0.05"
        self.f_2 = "25.78125"
        self.f_min = "0.05"
        self.f_p1 = "6.4453125"
        self.f_p2 = "25.78125"
        self.f_v = "4.0"
        self.f_f = "4.0"
        self.f_n = "4.0"
        self.f_r = "0.75"
        self.f_z = "6.4453125"
        self.g_dc = "[-12:1:0]"
        self.gdc_min = ""
        self.g_qual = ""
        self.g2_qual = ""
        self.l = "2.0"
        self.m = "32.0"
        self.n_b = "14.0"
        self.n_bx = "14.0"
        self.n_b_step = ""
        self.r_0 = "50.0"
        self.r_d = "[55 55]"
        self.r_lm = "1.0"
        self.sigma_rj = "0.01"
        self.snr_tx = "27.0"
        self.z_pfext = "[12 30]"
        self.z_pnext = "[12 12]"
        self.z_prx = "[12 30]"
        self.z_pselect = "[1 2]"
        self.z_ptx = "[12 30]"
        self.n_bg = "0"
        self.n_bf = "6"
        self.n_f = ""
        self.bmaxg = "0.2"
        self.b_float_rss_max = ""
        self.n_tail_start = ""
        self.samples_for_c2m = "100"
        self.t_o = ""
        self.ac_cm_rms = "0.0"
        self.accm_max_freq = "25.78125"
        self.enforce_causality = ""
        self.ec_pulse_tol = "0.01"
        self.ec_diff_tol = "1e-3"
        self.ec_rel_tol = "1e-2"
        self.force_pdf_bin_size = ""
        self.pdf_bin_size = "1e-5"
        self.imprsp_trunc_threshold = "1E-3"
        self.n_v = ""
        self.vec_pass_threshold = ""
        self.com_pass_threshold = "3.0"
        self.erl_pass_threshold = ""
        self.eh_max = ""
        self.eh_min = ""
        self.ctle_type = "CL93"
        self.f_hp_p = ""
        self.f_hp_pz = ""
        self.f_hp_z = ""
        self.g_dc_hp = ""
        self.include_pcb = "0.0"
        self.noise_crest_factor = ""
        self.pmd_type = "C2C"
        self.max_burst_len = ""
        self.err_propagation_com_margin = ""
        self.cdr = "MM"
        self.use_eta0_psd = ""
        self.tdr_w_txpkg = ""
        self.tdr_butterworth = ""
        self.butterworth = "TRUE"
        self.bessel_thomson = "FALSE"
        self.bt_order = "4"
        self.runtag = ""
        self.sigma_r = "0.02"
        self.histogram_window_weight = "RECTANGLE"
        self.optimize_loop_speed_up = "1"
        self.tdecq = ""
        self.port_order = "[1 3 2 4]"
        self.result_dir = ""
        self.min_veo_test = ""
        self.force_tr = "FALSE"
        self.ideal_tx_term = "0.0"
        self.rx_calibration = "0.0"
        self.sigma_bbn_step = "0.005"
        self.t_r = "0.008"
        self.t_r_filter_type = "FALSE"
        self.t_r_meas_point = "FALSE"
        self.ideal_rx_term = "0.0"
        self.include_ctle = "1.0"
        self.include_tx_rx_filter = "1.0"
        self.inc_package = "1.0"
        self.package_tl_gamma0_a1_a2 = "[0 1.734e-3 1.455e-4]"
        self.package_tl_tau = "0.006141"
        self.package_z_c = "78.2"
        self.board_tl_gamma0_a1_a2 = "[0 4.114e-4 2.547e-4]"
        self.board_tl_tau = "0.006191"
        self.board_z_c = "109.8"
        self.z_bpfext = "72.0"
        self.z_bpnext = "72.0"
        self.z_bprx = "151.0"
        self.z_bptx = "151.0"
        self.cb0 = ""
        self.cb1 = ""
        self.tdr = "0"
        self.erl = ""
        self.z_t = "50"
        self.erl_only = ""
        self.tr_tdr = "8.0E-3"
        self.tdr_duration = "5"
        self.n = ""
        self.kappa1 = "1.0"
        self.kappa2 = "1.0"
        self.tukey_window = ""
        self.beta_x = ""
        self.rho_x = ""
        self.fixture_delay_time = ""
        self.auto_tfx = ""
        self.grr_limit = "1"
        self.grr = "1"
        self.gx = ""
        self.ffe_pre_tap_len = ""
        self.ffe_post_tap_len = ""
        self.ffe_tap_step_size = "0"
        self.ffe_main_cur_min = "0.7"
        self.ffe_pre_tap1_max = "0.7"
        self.ffe_post_tap1_max = "0.7"
        self.ffe_tapn_max = "0.7"
        self.cursor_gain = ""
        self.sbr_gen_method = "DEFAULT"
        self.fixture_builtin_delay = "500p"

        self.standard = standard

    @property
    def standard(self):
        return self._standard

    @property
    def parameters(self):
        return {i: j for i, j in self.__dict__.items() if not i.startswith("_")}

    @standard.setter
    def standard(self, value):
        self._standard = value
        if value == "50GAUI-1_C2C":
            self.apply_120d_8()
        elif value == "100GBASE-KR4":
            self.apply_93_8()
        else:
            logger.error("invalid physical layer name.")

    @pyaedt_function_handler
    def load(self, file_path):
        self._standard = "custom"
        with open(file_path, "r") as fp:
            lines = fp.readlines()
            for line in lines:
                if not line.startswith("#") and "=" in line:
                    split_line = [i.strip() for i in line.split("=")]
                    name, value = split_line
                    self.__setattr__(name.lower(), str(value))

    @pyaedt_function_handler
    def export(self, file_path):
        with open(file_path, "w") as fp:
            fp.write("################################################################################\n")
            fp.write("# MODULE: COM\n")
            fp.write("# GENERATED ON\n")
            fp.write("################################################################################\n")
            for k, v in self.parameters.items():
                fp.write("# {0}: {0}\n".format(k.upper()))
                fp.write("{} = {}\n".format(k.upper(), v))

    @pyaedt_function_handler
    def apply_120d_8(self):
        self.a_dd = "0.02"
        self.a_fe = "0.45"
        self.a_ne = "0.65"
        self.a_ft = ""
        self.a_nt = ""
        self.a_v = "0.45"
        self.b_max1 = "0.5"
        self.b_min1 = ""
        self.b_max2_n_b = ""
        self.b_min2_n_b = ""
        self.c_1 = "[-0.15:0.05:0]"
        self.c_2 = ""
        self.c_3 = ""
        self.c_4 = ""
        self.c0 = "0.6"
        self.c1 = "[-0.25:0.05:0]"
        self.c2 = ""
        self.c3 = ""
        self.c_d = "[2.8e-4  2.8e-4]"
        self.c_p = "[1.1e-4 1.1e-4]"
        self.c_v = "0.0"
        self.l_s = ""
        self.c_b = ""
        self.local_search = ""
        self.delta_f = "0.01"
        self.ffe_backoff = "4"
        self.der_0 = "1.0E-5"
        self.eta_0 = "2.6E-8"
        self.f_b = "26.5625"
        self.f_1 = "0.05"
        self.f_2 = "26.5625"
        self.f_min = "0.05"
        self.f_p1 = "10.625"
        self.f_p2 = "1.0E99"
        self.f_v = "4.0"
        self.f_f = "4.0"
        self.f_n = "4.0"
        self.f_r = "0.75"
        self.f_z = "10.625"
        self.g_dc = "[-15:1:0]"
        self.gdc_min = ""
        self.g_qual = ""
        self.g2_qual = ""
        self.l = "4.0"
        self.m = "32.0"
        self.n_b = "10.0"
        self.n_bx = "10.0"
        self.n_b_step = ""
        self.r_0 = "50.0"
        self.r_d = "[55 55]"
        self.r_lm = "0.95"
        self.sigma_rj = "0.01"
        self.snr_tx = "31.0"
        self.z_pfext = "[12 30]"
        self.z_pnext = "[12 12]"
        self.z_prx = "[12 30]"
        self.z_pselect = "[1 2 ]"
        self.z_ptx = "[12 30]"
        self.n_bg = "0"
        self.n_bf = "6"
        self.n_f = ""
        self.bmaxg = "0.2"
        self.b_float_rss_max = ""
        self.n_tail_start = ""
        self.samples_for_c2m = "100"
        self.t_o = ""
        self.ac_cm_rms = "0.0"
        self.accm_max_freq = "26.5625"
        self.enforce_causality = ""
        self.ec_pulse_tol = "0.01"
        self.ec_diff_tol = "1e-3"
        self.ec_rel_tol = "1e-2"
        self.force_pdf_bin_size = ""
        self.pdf_bin_size = "1e-5"
        self.imprsp_trunc_threshold = "1E-3"
        self.n_v = ""
        self.vec_pass_threshold = ""
        self.com_pass_threshold = "3.0"
        self.erl_pass_threshold = "8"
        self.eh_max = ""
        self.eh_min = ""
        self.ctle_type = "CL93"
        self.f_hp_p = ""
        self.f_hp_pz = "0.6640625"
        self.f_hp_z = ""
        self.g_dc_hp = "[-4:1:0]"
        self.include_pcb = "0.0"
        self.noise_crest_factor = ""
        self.pmd_type = "C2C"
        self.max_burst_len = ""
        self.err_propagation_com_margin = ""
        self.cdr = "MM"
        self.use_eta0_psd = ""
        self.tdr_w_txpkg = ""
        self.tdr_butterworth = "1.0"
        self.butterworth = "TRUE"
        self.bessel_thomson = "FALSE"
        self.bt_order = "4"
        self.runtag = "V164"
        self.sigma_r = "0.02"
        self.histogram_window_weight = "RECTANGLE"
        self.optimize_loop_speed_up = "1"
        self.tdecq = ""
        self.port_order = "[1 3 2 4]"
        self.result_dir = ""
        self.min_veo_test = ""
        self.force_tr = "FALSE"
        self.ideal_tx_term = "0.0"
        self.rx_calibration = "0.0"
        self.sigma_bbn_step = "0.005"
        self.t_r = "0.013"
        self.t_r_filter_type = "1.0"
        self.t_r_meas_point = "0.0"
        self.ideal_rx_term = "0.0"
        self.include_ctle = "1.0"
        self.include_tx_rx_filter = "1.0"
        self.inc_package = "1.0"
        self.package_tl_gamma0_a1_a2 = "[0 1.734e-3 1.455e-4]"
        self.package_tl_tau = "0.006141"
        self.package_z_c = "85.0"
        self.board_tl_gamma0_a1_a2 = "[0 4.114e-4 2.547e-4]"
        self.board_tl_tau = "0.006191"
        self.board_z_c = "110.0"
        self.z_bpfext = "72.0"
        self.z_bpnext = "72.0"
        self.z_bprx = "151.0"
        self.z_bptx = "151.0"
        self.cb0 = ""
        self.cb1 = ""
        self.tdr = "1"
        self.erl = "1.0"
        self.z_t = "50.0"
        self.erl_only = "0.0"
        self.tr_tdr = "0.0189"
        self.tdr_duration = "10.0"
        self.n = ""
        self.kappa1 = "1.0"
        self.kappa2 = "1.0"
        self.tukey_window = ""
        self.beta_x = "1.07E10"
        self.rho_x = "0.44"
        self.fixture_delay_time = "0.0"
        self.auto_tfx = ""
        self.grr_limit = "1"
        self.grr = "1"
        self.gx = ""
        self.ffe_pre_tap_len = ""
        self.ffe_post_tap_len = ""
        self.ffe_tap_step_size = "0"
        self.ffe_main_cur_min = "0.7"
        self.ffe_pre_tap1_max = "0.7"
        self.ffe_post_tap1_max = "0.7"
        self.ffe_tapn_max = "0.7"
        self.cursor_gain = ""
        self.sbr_gen_method = "DEFAULT"
        self.fixture_builtin_delay = "500p"

    @pyaedt_function_handler
    def apply_93_8(self):
        self.a_dd = "0.05"
        self.a_fe = "0.4"
        self.a_ne = "0.6"
        self.a_ft = ""
        self.a_nt = ""
        self.a_v = "0.4"
        self.b_max1 = "1.0"
        self.b_min1 = ""
        self.b_max2_n_b = ""
        self.b_min2_n_b = ""
        self.c_1 = "[-0.18:0.02:0]"
        self.c_2 = ""
        self.c_3 = ""
        self.c_4 = ""
        self.c0 = "0.62"
        self.c1 = "[-0.38:0.02:0]"
        self.c2 = ""
        self.c3 = ""
        self.c_d = "[2.5e-4 2.5e-4]"
        self.c_p = "[1.8e-4 1.8e-4]"
        self.c_v = "0.0"
        self.l_s = ""
        self.c_b = ""
        self.local_search = ""
        self.delta_f = "0.01"
        self.ffe_backoff = "4"
        self.der_0 = "1.0E-5"
        self.eta_0 = "5.2E-8"
        self.f_b = "25.78125"
        self.f_1 = "0.05"
        self.f_2 = "25.78125"
        self.f_min = "0.05"
        self.f_p1 = "6.4453125"
        self.f_p2 = "25.78125"
        self.f_v = "4.0"
        self.f_f = "4.0"
        self.f_n = "4.0"
        self.f_r = "0.75"
        self.f_z = "6.4453125"
        self.g_dc = "[-12:1:0]"
        self.gdc_min = ""
        self.g_qual = ""
        self.g2_qual = ""
        self.l = "2.0"
        self.m = "32.0"
        self.n_b = "14.0"
        self.n_bx = "14.0"
        self.n_b_step = ""
        self.r_0 = "50.0"
        self.r_d = "[55 55]"
        self.r_lm = "1.0"
        self.sigma_rj = "0.01"
        self.snr_tx = "27.0"
        self.z_pfext = "[12 30]"
        self.z_pnext = "[12 12]"
        self.z_prx = "[12 30]"
        self.z_pselect = "[1 2]"
        self.z_ptx = "[12 30]"
        self.n_bg = "0"
        self.n_bf = "6"
        self.n_f = ""
        self.bmaxg = "0.2"
        self.b_float_rss_max = ""
        self.n_tail_start = ""
        self.samples_for_c2m = "100"
        self.t_o = ""
        self.ac_cm_rms = "0.0"
        self.accm_max_freq = "25.78125"
        self.enforce_causality = ""
        self.ec_pulse_tol = "0.01"
        self.ec_diff_tol = "1e-3"
        self.ec_rel_tol = "1e-2"
        self.force_pdf_bin_size = ""
        self.pdf_bin_size = "1e-5"
        self.imprsp_trunc_threshold = "1E-3"
        self.n_v = ""
        self.vec_pass_threshold = ""
        self.com_pass_threshold = "3.0"
        self.erl_pass_threshold = ""
        self.eh_max = ""
        self.eh_min = ""
        self.ctle_type = "CL93"
        self.f_hp_p = ""
        self.f_hp_pz = ""
        self.f_hp_z = ""
        self.g_dc_hp = ""
        self.include_pcb = "0.0"
        self.noise_crest_factor = ""
        self.pmd_type = "C2C"
        self.max_burst_len = ""
        self.err_propagation_com_margin = ""
        self.cdr = "MM"
        self.use_eta0_psd = ""
        self.tdr_w_txpkg = ""
        self.tdr_butterworth = ""
        self.butterworth = "TRUE"
        self.bessel_thomson = "FALSE"
        self.bt_order = "4"
        self.runtag = ""
        self.sigma_r = "0.02"
        self.histogram_window_weight = "RECTANGLE"
        self.optimize_loop_speed_up = "1"
        self.tdecq = ""
        self.port_order = "[1 3 2 4]"
        self.result_dir = ""
        self.min_veo_test = ""
        self.force_tr = "FALSE"
        self.ideal_tx_term = "0.0"
        self.rx_calibration = "0.0"
        self.sigma_bbn_step = "0.005"
        self.t_r = "0.008"
        self.t_r_filter_type = "FALSE"
        self.t_r_meas_point = "FALSE"
        self.ideal_rx_term = "0.0"
        self.include_ctle = "1.0"
        self.include_tx_rx_filter = "1.0"
        self.inc_package = "1.0"
        self.package_tl_gamma0_a1_a2 = "[0 1.734e-3 1.455e-4]"
        self.package_tl_tau = "0.006141"
        self.package_z_c = "78.2"
        self.board_tl_gamma0_a1_a2 = "[0 4.114e-4 2.547e-4]"
        self.board_tl_tau = "0.006191"
        self.board_z_c = "109.8"
        self.z_bpfext = "72.0"
        self.z_bpnext = "72.0"
        self.z_bprx = "151.0"
        self.z_bptx = "151.0"
        self.cb0 = ""
        self.cb1 = ""
        self.tdr = "0"
        self.erl = ""
        self.z_t = "50"
        self.erl_only = ""
        self.tr_tdr = "8.0E-3"
        self.tdr_duration = "5"
        self.n = ""
        self.kappa1 = "1.0"
        self.kappa2 = "1.0"
        self.tukey_window = ""
        self.beta_x = ""
        self.rho_x = ""
        self.fixture_delay_time = ""
        self.auto_tfx = ""
        self.grr_limit = "1"
        self.grr = "1"
        self.gx = ""
        self.ffe_pre_tap_len = ""
        self.ffe_post_tap_len = ""
        self.ffe_tap_step_size = "0"
        self.ffe_main_cur_min = "0.7"
        self.ffe_pre_tap1_max = "0.7"
        self.ffe_post_tap1_max = "0.7"
        self.ffe_tapn_max = "0.7"
        self.cursor_gain = ""
        self.sbr_gen_method = "DEFAULT"
        self.fixture_builtin_delay = "500p"
