name: 'Restore Testmon Cache'
description: 'Restores testmon data from cache for pull requests only'
inputs:
  testmon-datafile:
    description: 'Path to the testmon data file'
    required: true
    default: '.testmondata'
  cache-key:
    description: 'Base cache key for testmon data'
    required: true
    default: 'testmondata-all'

runs:
  using: "composite"
  steps:
    - name: Restore testmondata cache (PR only)
      if: github.event_name == 'pull_request'
      id: testmon-cache
      uses: actions/cache/restore@1bd1e32a3bdc45362d1e726936510720a7c30a57 # v4.2.0
      with:
        path: ${{ inputs.testmon-datafile }}
        key: ${{ inputs.cache-key }}-${{ github.base_ref || 'main' }}-${{ github.sha }}
        restore-keys: |
          ${{ inputs.cache-key }}-${{ github.base_ref || 'main' }}-
          ${{ inputs.cache-key }}-main-

    - name: Check testmon cache status
      shell: bash
      run: |
        if [ "${{ github.event_name }}" == "pull_request" ]; then
          if [ -f "${{ inputs.testmon-datafile }}" ]; then
            echo "✅ Testmon cache restored successfully"
            ls -lh ${{ inputs.testmon-datafile }}
          else
            echo "ℹ️ No testmon cache found - will run all tests"
          fi
        else
          echo "ℹ️ Running on main branch - will recreate testmon cache"
        fi
